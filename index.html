<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>โปรแกรมคำนวณค่าไฟค่าน้ำ</title>
  <style>
    body { font-family: 'Courier New', monospace; padding: 20px; background: #f2f2f2; }
    .container { background: #fff; padding: 20px; max-width: 600px; margin: auto; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    input, select { width: 100%; padding: 10px 15px; margin: 8px 0; border-radius: 6px; border: 1px solid #ccc; box-sizing: border-box; }
    button { width: 100%; padding: 12px; background: #007bff; border: none; border-radius: 6px; color: white; font-size: 16px; margin-top: 10px; cursor: pointer; }
    button:hover { background: #0056c1; }
    .result { background: #fafafa; padding: 15px; margin-top: 20px; border-radius: 10px; border: 1px solid #ddd; white-space: pre-line; font-family: 'Courier New', monospace; font-size: 15px; }
    .history { margin-top: 20px; max-height: 300px; overflow-y: auto; border: 1px solid #ccc; padding: 10px; background: #fff; border-radius: 8px; }
    .history-item { border-bottom: 1px solid #ddd; padding: 5px 0; }
    .history-item button { width: auto; padding: 5px 10px; margin-top: 5px; font-size: 14px; }
    @media print {
      @page { size: A5 portrait; margin: 20mm; }
      body { background: white; padding: 0; }
      .container { box-shadow: none; width: auto; margin: 0; }
      button { display: none; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>โปรแกรมคำนวณค่าไฟค่าน้ำ</h2>

    <label>ชื่อผู้เช่า</label>
    <input id="tenant_name" placeholder="เช่น นายเอ / นางสาวบี" />

    <label>ชื่อห้อง</label>
    <input id="room" placeholder="เช่น 101" />

    <label>วัน/เดือน/ปี</label>
    <input id="date" type="date" />

    <label>เลขมิเตอร์ไฟครั้งก่อน</label>
    <input id="old_elec" type="number" step="1" />

    <label>เลขมิเตอร์ไฟครั้งนี้</label>
    <input id="new_elec" type="number" step="1" />

    <label>เลขมิเตอร์น้ำครั้งก่อน</label>
    <input id="old_water" type="number" step="1" />

    <label>เลขมิเตอร์น้ำครั้งนี้</label>
    <input id="new_water" type="number" step="1" />

    <label>ค่าห้อง</label>
    <input id="room_cost" type="number" step="1" />

    <button onclick="calc()">คำนวณ</button>
    <button onclick="printPDF()">พิมพ์ใบเสร็จ</button>
    <button onclick="clearInputs()">เคลียร์ข้อมูลที่กรอก</button>

    <div id="result" class="result"></div>

    <h3>ประวัติการคำนวณ</h3>
    <div id="history" class="history"></div>

    <button onclick="clearHistory()">เคลียร์ประวัติทั้งหมด</button>
  </div>

  <script>
// ===== ตัวแปรหลัก =====
let currentData = {};
let historyData = [];

// ===== คำนวณ =====
function calc() {
  const tenant_name = document.getElementById('tenant_name').value;
  const room = document.getElementById('room').value;
  const date = document.getElementById('date').value;
  const old_elec = parseInt(document.getElementById('old_elec').value, 10);
  const new_elec = parseInt(document.getElementById('new_elec').value, 10);
  const old_water = parseInt(document.getElementById('old_water').value, 10);
  const new_water = parseInt(document.getElementById('new_water').value, 10);
  const room_cost = parseFloat(document.getElementById('room_cost').value) || 0;

  if ([old_elec, new_elec, old_water, new_water].some(isNaN)) {
    alert('กรุณากรอกเลขมิเตอร์ให้ครบ');
    return;
  }

  if (new_elec < old_elec || new_water < old_water) {
    alert('เลขมิเตอร์ใหม่ต้องมากกว่าหรือเท่าครั้งก่อน');
    return;
  }

  const elec_rate = 7;
  const water_rate = 16;

  const elec_use = new_elec - old_elec;
  const water_use = new_water - old_water;

  const elec_cost = elec_use * elec_rate;
  const water_cost = water_use * water_rate;
  const total = elec_cost + water_cost + room_cost;

  currentData = {
    tenant_name, room, date,
    elec_use, water_use,
    elec_cost, water_cost,
    room_cost, total
  };

  document.getElementById('result').innerHTML = formatBillTable(currentData);

  historyData.push(currentData);
  updateHistory();
}

// ===== แสดงใบเสร็จแบบตาราง =====
function formatBillTable(d) {
  return `
  <table style="width:100%; border-collapse:collapse;">
    <tr><th colspan="2" style="border:1px solid #000; padding:6px;">ใบเสร็จค่าใช้จ่าย</th></tr>
    <tr><td style="border:1px solid #000; padding:6px;">ผู้เช่า</td><td style="border:1px solid #000; padding:6px;">${d.tenant_name || '-'}</td></tr>
    <tr><td style="border:1px solid #000; padding:6px;">ห้อง</td><td style="border:1px solid #000; padding:6px;">${d.room || '-'}</td></tr>
    <tr><td style="border:1px solid #000; padding:6px;">วันที่</td><td style="border:1px solid #000; padding:6px;">${d.date || '-'}</td></tr>
    <tr><td colspan="2" style="border:1px solid #000; padding:6px;">ค่าไฟ ${d.elec_use} หน่วย = ${d.elec_cost.toFixed(2)}</td></tr>
    <tr><td colspan="2" style="border:1px solid #000; padding:6px;">ค่าน้ำ ${d.water_use} หน่วย = ${d.water_cost.toFixed(2)}</td></tr>
    <tr><td colspan="2" style="border:1px solid #000; padding:6px;">ค่าห้อง = ${d.room_cost.toFixed(2)}</td></tr>
    <tr><th colspan="2" style="border:1px solid #000; padding:6px;">รวม ${d.total.toFixed(2)} บาท</th></tr>
  </table>`;
}

// ===== ประวัติ =====
function updateHistory() {
  const h = document.getElementById('history');
  h.innerHTML = '';
  historyData.forEach((d, i) => {
    const div = document.createElement('div');
    div.className = 'history-item';
    div.innerHTML = `<div>${formatBillTable(d)}</div>`;
    h.appendChild(div);
  });
}

// ===== อื่น ๆ =====
function clearInputs() {
  document.querySelectorAll('input').forEach(i => i.value = '');
  document.getElementById('result').innerHTML = '';
}

function clearHistory() {
  historyData = [];
  document.getElementById('history').innerHTML = '';
}

function printPDF() {
  if (!currentData.total) { alert('กรุณากดคำนวณก่อน'); return; }
  const win = window.open('', '', 'width=600,height=800');
  win.document.write(`<!DOCTYPE html><html><head><title>ใบเสร็จ</title>
    <style>
      @page { size:A5 portrait; margin:20mm; }
      body { font-family:'Courier New', monospace; }
      table { width:100%; border-collapse:collapse; }
      th,td { border:1px solid #000; padding:6px; }
    </style>
  </head><body>${formatBillTable(currentData)}</body></html>`);
  win.document.close();
  win.print();
}
</script>
</body>
</html>
